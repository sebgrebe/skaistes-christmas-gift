YUI.add("subscriptions-helper",function(o){"use strict";o.SubscriptionsHelper=function(){this.FLICKR_PRO_3_MONTH_PLAN_ID=1,this.FLICKR_PRO_1_YEAR_PLAN_ID=2,this.FLICKR_PRO_2_YEARS_PLAN_ID=3,this.FLICKR_PRO_MONTHLY_PLAN_ID=7,this.FLICKR_PRO_ANNUAL_PLAN_ID=8,this.FLICKR_PRO_ANNUAL_TRIAL=9,this.FLICKR_PRO_OLD_ANNUAL_TRIAL=10,this.FLICKR_PRO_3_MONTH_V2_PLAN_ID=11,this.FLICKR_PRO_2_YEAR_V2_PLAN_ID=12,this.FLICKR_PRO_ANNUAL_PRICE=49.99,this.FLICKR_PRO_MONTHLY_PRICE=5.99,this.FLICKR_PRO_3_MONTH_V2_PRICE=15.99,this.FLICKR_PRO_2_YEAR_V2_PRICE=97.99,this.subscriptionsIdByName={"pro-3month":this.FLICKR_PRO_3_MONTH_PLAN_ID,"pro-3month-v2":this.FLICKR_PRO_3_MONTH_V2_PLAN_ID,"pro-1year":this.FLICKR_PRO_1_YEAR_PLAN_ID,"pro-2year":this.FLICKR_PRO_2_YEARS_PLAN_ID,"pro-2year-v2":this.FLICKR_PRO_2_YEAR_V2_PLAN_ID,"pro-monthly":this.FLICKR_PRO_MONTHLY_PLAN_ID,"pro-annual":this.FLICKR_PRO_ANNUAL_PLAN_ID,"pro-trial":this.FLICKR_PRO_ANNUAL_TRIAL},this.subscriptionStatusMap={initiated:1,active:2,closed:3,canceled:4,failed:5,refunded:6,pending:7,subscription_canceled:8,subscription_charged_successfully:9,subscription_charged_unsuccessfully:10,subscription_expired:11,subscription_went_past_due:12,change_initiated:13,closed_pending:14},this.subscriptionsIdHasAnnualPerk={1:!1,2:!0,3:!0,4:!0,6:!1,7:!1,8:!0,9:!0,10:!0,11:!1,12:!0},this.cardTypeMap={1:"visa",2:"master-card",3:"discover",4:"american-express",5:"JCB"},this.paymentVendorMap={braintree:10,oldpaypal:20,digitalriver:30},this.countriesArray=[{countryCode:"US",countryName:"United States"},{countryCode:"AF",countryName:"Afghanistan"},{countryCode:"AX",countryName:"Åland"},{countryCode:"AL",countryName:"Albania"},{countryCode:"DZ",countryName:"Algeria"},{countryCode:"AS",countryName:"American Samoa"},{countryCode:"AD",countryName:"Andorra"},{countryCode:"AO",countryName:"Angola"},{countryCode:"AI",countryName:"Anguilla"},{countryCode:"AQ",countryName:"Antarctica"},{countryCode:"AG",countryName:"Antigua and Barbuda"},{countryCode:"AR",countryName:"Argentina"},{countryCode:"AM",countryName:"Armenia"},{countryCode:"AW",countryName:"Aruba"},{countryCode:"AU",countryName:"Australia"},{countryCode:"AT",countryName:"Austria"},{countryCode:"AZ",countryName:"Azerbaijan"},{countryCode:"BS",countryName:"Bahamas"},{countryCode:"BH",countryName:"Bahrain"},{countryCode:"BD",countryName:"Bangladesh"},{countryCode:"BB",countryName:"Barbados"},{countryCode:"BY",countryName:"Belarus"},{countryCode:"BE",countryName:"Belgium"},{countryCode:"BZ",countryName:"Belize"},{countryCode:"BJ",countryName:"Benin"},{countryCode:"BM",countryName:"Bermuda"},{countryCode:"BT",countryName:"Bhutan"},{countryCode:"BO",countryName:"Bolivia"},{countryCode:"BQ",countryName:"Bonaire, Sint Eustatius and Saba"},{countryCode:"BA",countryName:"Bosnia and Herzegovina"},{countryCode:"BW",countryName:"Botswana"},{countryCode:"BV",countryName:"Bouvet Island"},{countryCode:"BR",countryName:"Brazil"},{countryCode:"IO",countryName:"British Indian Ocean Territory"},{countryCode:"BN",countryName:"Brunei Darussalam"},{countryCode:"BG",countryName:"Bulgaria"},{countryCode:"BF",countryName:"Burkina Faso"},{countryCode:"BI",countryName:"Burundi"},{countryCode:"KH",countryName:"Cambodia"},{countryCode:"CM",countryName:"Cameroon"},{countryCode:"CA",countryName:"Canada"},{countryCode:"CV",countryName:"Cape Verde"},{countryCode:"KY",countryName:"Cayman Islands"},{countryCode:"CF",countryName:"Central African Republic"},{countryCode:"TD",countryName:"Chad"},{countryCode:"CL",countryName:"Chile"},{countryCode:"CN",countryName:"China"},{countryCode:"CX",countryName:"Christmas Island"},{countryCode:"CC",countryName:"Cocos (Keeling) Islands"},{countryCode:"CO",countryName:"Colombia"},{countryCode:"KM",countryName:"Comoros"},{countryCode:"CG",countryName:"Congo (Brazzaville)"},{countryCode:"CD",countryName:"Congo (Kinshasa)"},{countryCode:"CK",countryName:"Cook Islands"},{countryCode:"CR",countryName:"Costa Rica"},{countryCode:"CI",countryName:"Côte d'Ivoire"},{countryCode:"HR",countryName:"Croatia"},{countryCode:"CW",countryName:"Curaçao"},{countryCode:"CY",countryName:"Cyprus"},{countryCode:"CZ",countryName:"Czech Republic"},{countryCode:"DK",countryName:"Denmark"},{countryCode:"DJ",countryName:"Djibouti"},{countryCode:"DM",countryName:"Dominica"},{countryCode:"DO",countryName:"Dominican Republic"},{countryCode:"EC",countryName:"Ecuador"},{countryCode:"EG",countryName:"Egypt"},{countryCode:"SV",countryName:"El Salvador"},{countryCode:"GQ",countryName:"Equatorial Guinea"},{countryCode:"ER",countryName:"Eritrea"},{countryCode:"EE",countryName:"Estonia"},{countryCode:"ET",countryName:"Ethiopia"},{countryCode:"FK",countryName:"Falkland Islands"},{countryCode:"FO",countryName:"Faroe Islands"},{countryCode:"FJ",countryName:"Fiji"},{countryCode:"FI",countryName:"Finland"},{countryCode:"FR",countryName:"France"},{countryCode:"GF",countryName:"French Guiana"},{countryCode:"PF",countryName:"French Polynesia"},{countryCode:"TF",countryName:"French Southern Lands"},{countryCode:"GA",countryName:"Gabon"},{countryCode:"GM",countryName:"Gambia"},{countryCode:"GE",countryName:"Georgia"},{countryCode:"DE",countryName:"Germany"},{countryCode:"GH",countryName:"Ghana"},{countryCode:"GI",countryName:"Gibraltar"},{countryCode:"GR",countryName:"Greece"},{countryCode:"GL",countryName:"Greenland"},{countryCode:"GD",countryName:"Grenada"},{countryCode:"GP",countryName:"Guadeloupe"},{countryCode:"GU",countryName:"Guam"},{countryCode:"GT",countryName:"Guatemala"},{countryCode:"GG",countryName:"Guernsey"},{countryCode:"GN",countryName:"Guinea"},{countryCode:"GW",countryName:"Guinea-Bissau"},{countryCode:"GY",countryName:"Guyana"},{countryCode:"HT",countryName:"Haiti"},{countryCode:"HM",countryName:"Heard and McDonald Islands"},{countryCode:"HN",countryName:"Honduras"},{countryCode:"HK",countryName:"Hong Kong"},{countryCode:"HU",countryName:"Hungary"},{countryCode:"IS",countryName:"Iceland"},{countryCode:"IN",countryName:"India"},{countryCode:"ID",countryName:"Indonesia"},{countryCode:"IE",countryName:"Ireland"},{countryCode:"IM",countryName:"Isle of Man"},{countryCode:"IL",countryName:"Israel"},{countryCode:"IT",countryName:"Italy"},{countryCode:"JM",countryName:"Jamaica"},{countryCode:"JP",countryName:"Japan"},{countryCode:"JE",countryName:"Jersey"},{countryCode:"JO",countryName:"Jordan"},{countryCode:"KZ",countryName:"Kazakhstan"},{countryCode:"KE",countryName:"Kenya"},{countryCode:"KI",countryName:"Kiribati"},{countryCode:"KR",countryName:"Korea, South"},{countryCode:"KW",countryName:"Kuwait"},{countryCode:"KG",countryName:"Kyrgyzstan"},{countryCode:"LA",countryName:"Laos"},{countryCode:"LV",countryName:"Latvia"},{countryCode:"LB",countryName:"Lebanon"},{countryCode:"LS",countryName:"Lesotho"},{countryCode:"LR",countryName:"Liberia"},{countryCode:"LY",countryName:"Libya"},{countryCode:"LI",countryName:"Liechtenstein"},{countryCode:"LT",countryName:"Lithuania"},{countryCode:"LU",countryName:"Luxembourg"},{countryCode:"MO",countryName:"Macau"},{countryCode:"MK",countryName:"Macedonia"},{countryCode:"MG",countryName:"Madagascar"},{countryCode:"MW",countryName:"Malawi"},{countryCode:"MY",countryName:"Malaysia"},{countryCode:"MV",countryName:"Maldives"},{countryCode:"ML",countryName:"Mali"},{countryCode:"MT",countryName:"Malta"},{countryCode:"MH",countryName:"Marshall Islands"},{countryCode:"MQ",countryName:"Martinique"},{countryCode:"MR",countryName:"Mauritania"},{countryCode:"MU",countryName:"Mauritius"},{countryCode:"YT",countryName:"Mayotte"},{countryCode:"MX",countryName:"Mexico"},{countryCode:"FM",countryName:"Micronesia"},{countryCode:"MD",countryName:"Moldova"},{countryCode:"MC",countryName:"Monaco"},{countryCode:"MN",countryName:"Mongolia"},{countryCode:"ME",countryName:"Montenegro"},{countryCode:"MS",countryName:"Montserrat"},{countryCode:"MA",countryName:"Morocco"},{countryCode:"MZ",countryName:"Mozambique"},{countryCode:"MM",countryName:"Myanmar"},{countryCode:"NA",countryName:"Namibia"},{countryCode:"NR",countryName:"Nauru"},{countryCode:"NP",countryName:"Nepal"},{countryCode:"NL",countryName:"Netherlands"},{countryCode:"AN",countryName:"Netherlands Antilles"},{countryCode:"NC",countryName:"New Caledonia"},{countryCode:"NZ",countryName:"New Zealand"},{countryCode:"NI",countryName:"Nicaragua"},{countryCode:"NE",countryName:"Niger"},{countryCode:"NG",countryName:"Nigeria"},{countryCode:"NU",countryName:"Niue"},{countryCode:"NF",countryName:"Norfolk Island"},{countryCode:"MP",countryName:"Northern Mariana Islands"},{countryCode:"NO",countryName:"Norway"},{countryCode:"OM",countryName:"Oman"},{countryCode:"PK",countryName:"Pakistan"},{countryCode:"PW",countryName:"Palau"},{countryCode:"PS",countryName:"Palestine"},{countryCode:"PA",countryName:"Panama"},{countryCode:"PG",countryName:"Papua New Guinea"},{countryCode:"PY",countryName:"Paraguay"},{countryCode:"PE",countryName:"Peru"},{countryCode:"PH",countryName:"Philippines"},{countryCode:"PN",countryName:"Pitcairn"},{countryCode:"PL",countryName:"Poland"},{countryCode:"PT",countryName:"Portugal"},{countryCode:"PR",countryName:"Puerto Rico"},{countryCode:"QA",countryName:"Qatar"},{countryCode:"RE",countryName:"Reunion"},{countryCode:"RO",countryName:"Romania"},{countryCode:"RU",countryName:"Russian Federation"},{countryCode:"RW",countryName:"Rwanda"},{countryCode:"BL",countryName:"Saint Barthélemy"},{countryCode:"SH",countryName:"Saint Helena"},{countryCode:"KN",countryName:"Saint Kitts and Nevis"},{countryCode:"LC",countryName:"Saint Lucia"},{countryCode:"MF",countryName:"Saint Martin (French part)"},{countryCode:"PM",countryName:"Saint Pierre and Miquelon"},{countryCode:"VC",countryName:"Saint Vincent and the Grenadines"},{countryCode:"WS",countryName:"Samoa"},{countryCode:"SM",countryName:"San Marino"},{countryCode:"ST",countryName:"Sao Tome and Principe"},{countryCode:"SA",countryName:"Saudi Arabia"},{countryCode:"SN",countryName:"Senegal"},{countryCode:"RS",countryName:"Serbia"},{countryCode:"SC",countryName:"Seychelles"},{countryCode:"SL",countryName:"Sierra Leone"},{countryCode:"SG",countryName:"Singapore"},{countryCode:"SX",countryName:"Sint Maarten (Dutch part)"},{countryCode:"SK",countryName:"Slovakia"},{countryCode:"SI",countryName:"Slovenia"},{countryCode:"SB",countryName:"Solomon Islands"},{countryCode:"SO",countryName:"Somalia"},{countryCode:"ZA",countryName:"South Africa"},{countryCode:"GS",countryName:"South Georgia and South Sandwich Islands"},{countryCode:"SS",countryName:"South Sudan"},{countryCode:"ES",countryName:"Spain"},{countryCode:"LK",countryName:"Sri Lanka"},{countryCode:"SD",countryName:"Sudan"},{countryCode:"SR",countryName:"Suriname"},{countryCode:"SJ",countryName:"Svalbard and Jan Mayen Islands"},{countryCode:"SZ",countryName:"Swaziland"},{countryCode:"SE",countryName:"Sweden"},{countryCode:"CH",countryName:"Switzerland"},{countryCode:"TW",countryName:"Taiwan"},{countryCode:"TJ",countryName:"Tajikistan"},{countryCode:"TZ",countryName:"Tanzania"},{countryCode:"TH",countryName:"Thailand"},{countryCode:"TL",countryName:"Timor-Leste"},{countryCode:"TG",countryName:"Togo"},{countryCode:"TK",countryName:"Tokelau"},{countryCode:"TO",countryName:"Tonga"},{countryCode:"TT",countryName:"Trinidad and Tobago"},{countryCode:"TN",countryName:"Tunisia"},{countryCode:"TR",countryName:"Turkey"},{countryCode:"TM",countryName:"Turkmenistan"},{countryCode:"TC",countryName:"Turks and Caicos Islands"},{countryCode:"TV",countryName:"Tuvalu"},{countryCode:"UG",countryName:"Uganda"},{countryCode:"UA",countryName:"Ukraine"},{countryCode:"AE",countryName:"United Arab Emirates"},{countryCode:"GB",countryName:"United Kingdom"},{countryCode:"UM",countryName:"United States Minor Outlying Islands"},{countryCode:"UY",countryName:"Uruguay"},{countryCode:"UZ",countryName:"Uzbekistan"},{countryCode:"VU",countryName:"Vanuatu"},{countryCode:"VA",countryName:"Vatican City"},{countryCode:"VN",countryName:"Vietnam"},{countryCode:"VG",countryName:"Virgin Islands, British"},{countryCode:"VI",countryName:"Virgin Islands, U.S."},{countryCode:"WF",countryName:"Wallis and Futuna Islands"},{countryCode:"EH",countryName:"Western Sahara"},{countryCode:"YE",countryName:"Yemen"},{countryCode:"ZM",countryName:"Zambia"},{countryCode:"ZW",countryName:"Zimbabwe"}]},o.SubscriptionsHelper.prototype.canSeeAnnualProPerks=function(t,e){if(e){var n=e.toJSON();if(!t.getValue("isPro"))return!1;if(n.oneTimePro.isOneTimePro)return!0;if(t.getValue("isPro")){var r=o.Array.filter(n.subscriptions,function(t){return t.status===this.subscriptionStatusMap.active||t.status===this.subscriptionStatusMap.closed&&void 0!==t.effectiveEndDate&&t.effectiveEndDate.isAfter(o.moment())||t.status===this.subscriptionStatusMap.subscription_went_past_due||t.status===this.subscriptionStatusMap.pending&&(void 0!==t.startDate&&t.startDate.isBefore(o.moment())||null!==t.transactions&&t.transactions.length>0)}.bind(this));return!(!r||!r[0])&&this.subscriptionsIdHasAnnualPerk[r[0].type]}}},o.SubscriptionsHelper.prototype.canPlanIdSeeAnnualPerks=function(o){return this.subscriptionsIdHasAnnualPerk[o]},o.SubscriptionsHelper.prototype.convertDesiredPlan=function(o,t){var e,n="pro-3month"===o||"pro-3month-v2"===o||"pro-1year"===o||"pro-2year"===o||"pro-2year-v2"===o,r=!!t&&t.flipper.isFlipped("enable-opt-in-migration");if(n)if(r)switch(o){case"pro-monthly":e="pro-monthly";break;case"pro-3month":case"pro-3month-v2":e="pro-3month-v2";break;case"pro-1year":e="pro-annual";break;case"pro-2year":case"pro-2year-v2":e="pro-2year-v2";break;default:e="pro-annual"}else switch(o){case"pro-3month":e="pro-monthly";break;case"pro-1year":case"pro-2year":default:e="pro-annual"}else e=o;return e},o.SubscriptionsHelper.prototype.getPlanIdWithPlanName=function(o){var t=this.FLICKR_PRO_ANNUAL_PLAN_ID;return void 0!==this.subscriptionsIdByName[o]&&(t=this.subscriptionsIdByName[o]),t},o.SubscriptionsHelper.prototype.getPlanNameWithPlanId=function(o){var t="";for(var e in this.subscriptionsIdByName)if(this.subscriptionsIdByName[e]===o){t=e;break}return t},o.SubscriptionsHelper.prototype.canPurchaseAtLeastOnePlan=function(o){var t=[];return o&&(t=o.filter(function(o){return 1===o.canPurchase})),t.length>0},o.SubscriptionsHelper.prototype.canPurchaseThisPlanId=function(o,t){var e=[];return o&&t&&(e=t.filter(function(t){return t.planId===o})),e.length>0},o.SubscriptionsHelper.prototype.getNewProPlans=function(o){if(o)return o.filter(function(o){return"FlickrNewPro"===o.familyName})},o.SubscriptionsHelper.prototype.getOldProPlans=function(o){if(o)return o.filter(function(o){return"FlickrPro"===o.familyName})},o.SubscriptionsHelper.prototype.getPlanWithIdInPlansList=function(o){},o.SubscriptionsHelper.prototype.sanitizeCouponCode=function(o){var t=!1;if(o){if(t=o.trim(),o.length<=1)return!1;if(!t.match(/^[\w\-]+$/))return!1}return t},o.SubscriptionsHelper.prototype.convertLocaleToPaypalFormat=function(o){if(o){return{"de-DE":"de_DE","en-US":"en_US","es-US":"es_ES","fr-FR":"fr_FR","id-ID":"id_ID","it-IT":"it_IT","ko-KR":"ko_KR","pt-BR":"pt_PT","vi-VN":"en_US","zh-Hant-HK":"zh_HK"}[o]}},o.SubscriptionsHelper.prototype.getNiceCardType=function(o){return this.cardTypeMap[o]},o.SubscriptionsHelper.prototype.getPaymentVendorType=function(o){return this.paymentVendorMap[o]},o.SubscriptionsHelper.prototype.isPaymentVendorBraintree=function(o){return o===this.paymentVendorMap.braintree},o.SubscriptionsHelper.prototype.isPaymentVendorDigitalRiver=function(o){return o===this.paymentVendorMap.digitalriver},o.SubscriptionsHelper.prototype.hasYearlyLegalNotice=function(o){return this.subscriptionsIdHasAnnualPerk[o]},o.SubscriptionsHelper.prototype.log=function(t,e){!YUI.Env.isServer&&o.config.win.beaconError&&o.config.win.beaconError("[flickr-add-payment-method] "+t,o.config.win.location.href,e||{})},o.SubscriptionsHelper.prototype.beaconTransactionStep=function(t,e){!YUI.Env.isServer&&o.config.win.beaconError&&o.config.win.beaconError("[PRO] "+t,o.config.win.location.href,e||{})},o.SubscriptionsHelper.prototype.doesPlanIdHaveTrial=function(o){return o===this.FLICKR_PRO_ANNUAL_PLAN_ID||o===this.FLICKR_PRO_1_YEAR_PLAN_ID||o===this.FLICKR_PRO_2_YEARS_PLAN_ID},o.SubscriptionsHelper.prototype.canPurchaseTrialPlan=function(t,e){if(t&&e){var n;return n=t.getValue("products"),o.Array.filter(n,function(o){return o.planId===this.FLICKR_PRO_ANNUAL_TRIAL&&1===o.canPurchase||o.planId===this.FLICKR_PRO_OLD_ANNUAL_TRIAL&&1===o.canPurchase}.bind(this)).length>0}},o.SubscriptionsHelper.prototype.getTrialLength=function(){return 45},o.SubscriptionsHelper.prototype.formatSubscriptionModels=function(t){var e=t;return!e||!e.toJSON()||!e.toJSON().subscriptions||!e.toJSON().subscriptions instanceof Array||0===e.toJSON().subscriptions.length?[]:o.Array.map(e.toJSON().subscriptions,function(o){var t,e=o.amountBilled?o.amountBilled.toFixed(2):"0.00",n=o.pendingPrice?o.pendingPrice.toFixed(2):"0.00";return t=o.status!==this.subscriptionStatusMap.closed&&"object"==typeof o.effectiveEndDate&&"object"==typeof o.nextBillingDate?o.nextBillingDate.format("LL"):"",{type:o.type,startDate:"object"==typeof o.startDate?o.startDate.format("LL"):"",renewDate:t,nextBillingDate:o.nextBillingDate,id:o.id,name:o.prettyName,duration:o.prettyNameDuration,price:e,pendingPrice:n,status:o.status,isClosed:o.status===this.subscriptionStatusMap.closed,isPastDue:o.status===this.subscriptionStatusMap.subscription_went_past_due,effectiveEndDate:o.effectiveEndDate,paymentVendorType:o.paymentVendorType,isDigitalRiverSubscription:this.isPaymentVendorDigitalRiver(o.paymentVendorType),transactions:o.transactions}}.bind(this))},o.SubscriptionsHelper.prototype.getActiveAndPendingSubscriptions=function(t){var e,n;return e=o.Array.filter(this.formatSubscriptionModels(t),function(o){return o.status===this.subscriptionStatusMap.pending}.bind(this)),n=o.Array.filter(this.formatSubscriptionModels(t),function(t){return t.status===this.subscriptionStatusMap.active||t.status===this.subscriptionStatusMap.closed&&void 0!==t.effectiveEndDate&&t.effectiveEndDate.isAfter(o.moment())||t.status===this.subscriptionStatusMap.subscription_went_past_due}.bind(this)),{activeSubs:n,pendingSubs:e}},o.SubscriptionsHelper.prototype.isUserOnActiveButClosedPro=function(t){var e=this.getActiveAndPendingSubscriptions(t);return o.Array.filter(e.activeSubs,function(o){return o.status!==this.subscriptionStatusMap.active}.bind(this)).length>=1&&e.pendingSubs&&0===e.pendingSubs.length},o.SubscriptionsHelper.prototype.isUserCurrentlyOnADigitalRiverSub=function(o){var t=this.getActiveAndPendingSubscriptions(o),e=!1;if(t.activeSubs&&t.activeSubs.length>0){var n=t.activeSubs[0];if(t.pendingSubs&&t.pendingSubs.length>0){var r=t.pendingSubs[0];r&&(e=r.isDigitalRiverSubscription)}else e=n.isDigitalRiverSubscription}return e},o.SubscriptionsHelper.prototype.isUserPastDue=function(t){var e=[],n=this.getActiveAndPendingSubscriptions(t);return(e=o.Array.filter(n.activeSubs,function(o){return o.status===this.subscriptionStatusMap.subscription_went_past_due}.bind(this)))&&e.length>=1},o.SubscriptionsHelper.prototype.hasPurchasedTrialInThePast=function(t){var e=t.toJSON();return o.Array.filter(e,function(o){return o.planId===this.FLICKR_PRO_ANNUAL_TRIAL||o.planId===this.FLICKR_PRO_OLD_ANNUAL_TRIAL}.bind(this)).length>0},o.SubscriptionsHelper.prototype.isOnActiveTrial=function(o){var t=this.getActiveAndPendingSubscriptions(o),e=!1;return t&&t.activeSubs&&t.activeSubs.length>0&&(e=t.activeSubs[0].type===this.FLICKR_PRO_ANNUAL_TRIAL||t.activeSubs[0].type===this.FLICKR_PRO_OLD_ANNUAL_TRIAL),e},o.SubscriptionsHelper.prototype.isOneTimePro=function(o){return o.toJSON().oneTimePro.isOneTimePro},o.SubscriptionsHelper.prototype.getShopperCurrencyAndLocale=function(t){var e="US",n="en_US",r="USD",a=!1;if(!t&&o.config.flickr.geo?(o.config.flickr.geo.countryCode&&(e=o.config.flickr.geo.countryCode),o.config.flickr.geo.eu&&(a=o.config.flickr.geo.eu)):t&&(e=t.countryCode||"US",a=t.eu||!1),a)"GB"===e?(n="en_IE",r="GBP"):(n="en_IE",r="EUR");else switch(e){case"US":n="en_US",r="USD";break;case"CA":n="en_IE",r="CAD";break;default:n="en_IE",r="USD"}return{locale:n,currency:r}},o.SubscriptionsHelper.prototype.canUserSeeDigitalRiver=function(o){return!0},o.SubscriptionsHelper.prototype.getPriceWithCurrency=function(o,t,e){var n=e.replace("_","-");return new Intl.NumberFormat(n,{style:"currency",currency:t}).format(o)},o.SubscriptionsHelper.prototype.doesCountryRequiresSignedInGifting=function(o){return!(!o||!o.countryCode||"VN"!==o.countryCode)},o.SubscriptionsHelper.prototype.isADeniedCountry=function(o){return!!(o&&o.countryCode&&["VE","CU","IR","IQ","KP","SY"].indexOf(o.countryCode)>-1)},o.SubscriptionsHelper.prototype.isProductPubliclyAvailable=function(o,t){if(o&&t){if(o.flipper.isFlipped("enable-opt-in-migration"))return!0;return-1===[this.FLICKR_PRO_3_MONTH_V2_PLAN_ID,this.FLICKR_PRO_2_YEAR_V2_PLAN_ID].indexOf(t)}return!1}},"@VERSION@",{requires:["moment","timezone-helper","array-extras"],optional:[]});YUI.add("subscription-history-list-models",function(e){function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{name:this.name,remote:{read:function(r){return e.ModelFetchers["flickr-braintree-customerDetails-fetcher"].run(r,this.appContext)}},attributes:{subscriptions:{isListProxy:!0},oneTimePro:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-braintree-customerDetails-fetcher"]});YUI.add("flickr-braintree-customerDetails-fetcher",function(e,t){"use strict";function s(e){return{account_id:e.id}}require("hermes-core/flog")(t);e.namespace("ModelFetchers")["flickr-braintree-customerDetails-fetcher"]={run:function(i,r){var n=this,a=s(i);return e.Promise.all([r.callAPI("flickr.subscriptions.braintree.getCustomerDetails",a,!0),r.getModelRegistry("subscription-history-list-models"),r.getModelRegistry("subscription-history-models")]).then(function(e){return n._processResponse(e,i,r)},e.PromiseCatcher(t))},_processParams:s,_processResponse:function(t,s,i){var r,n=t[0],a=t[1],o=t[2],c={};(r=n.customerDetails.subscriptions)&&r instanceof Array&&(c.subscriptions=r.map(function(t){var s={};return t.status=parseInt(t.status,10),t.type=parseInt(t.type,10),s.startDate=1e3*t.startDate,s.billingScheduleMonths=t.billingScheduleMonths,s.nextBillingDate=1e3*t.nextBillingDate,s.effectiveEndDate=1e3*t.effectiveEndDate,s.type=t.type,s.paymentMethodId=t.paymentMethodId,s.status=t.status,s.amountBilled=t.amountBilled,s.transactions=t.transactions,s.prettyName=t.planInfo.prettyName,s.prettyNameDuration=t.planInfo.prettyNameDuration,s.pendingPrice=t.pendingPrice||void 0,s.paymentVendorType=t.paymentVendorType||void 0,e.Array.each(s.transactions,function(t){t.formattedCreateDate=e.moment(t.dateCreate,"X").format("MMM Do, YYYY"),t.isRefund=!1,3===parseInt(t.transactionType,10)&&(t.isRefund=!0)}),o.exists(t.id)?(o.setValues(t.id,s),o.proxy(t.id)):(s.id=t.id,o.add(s))}),n.customerDetails.paymentHistory&&(c.oneTimePro=n.customerDetails.paymentHistory.proStatus)),a.exists(s.id)?a.setValues(s.id,c):(c.id=s.id,a.add(c))}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["subscription-history-models","subscription-history-list-models"]});YUI.add("subscription-history-models",function(t){function e(t){e.superclass.constructor.call(this,t)}var r=new t.SubscriptionsHelper;t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{update:function(e,r){return t.ModelUpdaters["flickr-subscriptions-changePlan-updater"].run({current_plan_type:r.type.prevVal,new_plan_type:r.type.newVal},this.appContext)},delete:function(e){return t.ModelDeletors["flickr-braintree-close-deletor"].run({subscription_id:e},this.appContext)}},attributes:{startDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},nextBillingDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},effectiveEndDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},billingScheduleMonths:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return 0}},type:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return-1}},paymentMethodId:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},prettyName:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},prettyNameDuration:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},status:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return-1}},amountBilled:{validator:function(e,r){return t.AttributeHelpers.validateFloat(e)},setter:function(e){return t.AttributeHelpers.coerceFloat(e)||void 0},defaultFn:function(t){return 0}},pendingPrice:{validator:function(e,r){return t.AttributeHelpers.validateFloat(e)},setter:function(e){return t.AttributeHelpers.coerceFloat(e)||void 0},defaultFn:function(t){return 0}},transactions:{},paymentVendorType:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:r.getPaymentVendorType("braintree")}}})},"@VERSION@",{requires:["flickr-braintree-customerDetails-fetcher","flickr-subscriptions-changePlan-updater","flickr-braintree-close-deletor","subscriptions-helper"]});YUI.add("subscription-info-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-subscriptions-info-fetcher"].run(e,this.appContext)}},getFamilyInfoById:function(t,e){return this.getValue(t,"products").filter(function(t){return t.plan_id===e})},getPlanInfoById:function(t,e){return this.getValue(t,"products").filter(function(t){return t.planId===e})},getRawPlanPriceById:function(t,e){var n=this.getPlanInfoById(t,e);if(n&&n.length)return n[0].priceAfterTax},getFormattedPlanPriceById:function(t,e){var n=this.getPlanInfoById(t,e);if(n&&n.length)return n[0].formattedPriceAfterTax},getRawPlanDiscountPriceById:function(t,e){var n=this.getPlanInfoById(t,e);if(n&&n.length)return n[0].discountedPrice},attributes:{products:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-subscriptions-info-fetcher"]});YUI.add("flickr-subscriptions-info-fetcher",function(r,e){"use strict";function t(r){switch(parseInt(r,10)){case 1:return"1 Month";case 3:return"3 Months";case 12:return"1 Year";case 24:return"2 Years";default:return""}}var a=new r.SubscriptionsHelper;r.namespace("ModelFetchers")["flickr-subscriptions-info-fetcher"]={run:function(t,a){var n,i=this,o=parseInt(a.flipper.getValue("enable-mocking-pro")||0,10);return n=a.flipper.isFlipped("enable-digital-river")&&t&&t.currency?a.callAPI("flickr.digital.river.subscriptions.getAvailableProducts",t):o>0?new r.Promise(function(r,e){r({planOptions:{productFamily:[{productFamilyName:"FlickrPro",canPurchaseProduct:o<4,planOption:[{planId:1,name:"FlickrPro3Months",durationMonths:3,price:6.95,prettyName:"Flickr Pro",prettyNameDuration:"3 Months"},{planId:2,name:"FlickrPro1Year",durationMonths:12,price:24.95,prettyName:"Flickr Pro",prettyNameDuration:"1 Year"},{planId:3,name:"FlickrPro2Year",durationMonths:24,price:44.95,prettyName:"Flickr Pro",prettyNameDuration:"2 Years"}]},{productFamilyName:"AdFree",canPurchaseProduct:4===o||6===o,planOption:[{planId:4,name:"AdFree1Year",durationMonths:12,price:49.99,prettyName:"Flickr Pro",prettyNameDuration:"1 Year"},{planId:6,name:"AdFree1Month",durationMonths:1,price:5.99,prettyName:"Flickr Pro",prettyNameDuration:"1 Month"}]},{productFamilyName:"Doublr",canPurchaseProduct:0,planOption:[{planId:5,name:"Doublr1Year",durationMonths:12,price:"499.99",prettyName:"Doublr",prettyNameDuration:"1 Year"}]},{productFamilyName:"FlickrNewPro",canPurchaseProduct:o>=7,planOption:[{planId:7,name:"ProV21Month",durationMonths:1,price:5.99,prettyName:"Flickr Pro",prettyNameDuration:"1 Month"},{planId:8,name:"ProV21Year",durationMonths:12,price:49.99,prettyName:"Flickr Pro",prettyNameDuration:"1 Year"}]}]}})}):a.callAPI("flickr.subscriptions.getSubscriptionInfo",t),r.Promise.all([n,a.getModelRegistry("subscription-info-models")]).then(function(r){return i._processResponse(r,t,a)},r.FetcherErrorLogger(e))},_processResponse:function(r,e,n){var i,o=r[0],c=r[1];if(i={id:e.id},i.products=[],n.flipper.isFlipped("enable-digital-river")&&e&&e.currency){var p;if(!o.planOptions||!o.planOptions.planInfo)return i;p=o.canPurchase,o.planOptions.planInfo.forEach(function(r){r.familyName="FlickrNewPro",r.formattedLength=t(r.durationMonths),r.canPurchase=p,r.price=r.priceAfterTax,r.discountedPrice&&(r.formattedDiscountedPrice=r.formattedDiscountedPrice,r.genericCouponData={couponCode:e.coupon_code,discountedPrice:r.discountedPrice,formattedDiscountedPrice:r.formattedDiscountedPrice,originalPrice:r.priceAfterTax}),a.isProductPubliclyAvailable(n,r.planId)&&i.products.push(r)})}else o.planOptions.productFamily.forEach(function(r){r.planOption.forEach(function(e){e.familyName=r.productFamilyName,e.formattedLength=t(e.durationMonths),e.canPurchase=r.canPurchaseProduct,a.isProductPubliclyAvailable(n,e.planId)&&i.products.push(e)})});c.addOrUpdate(i)}}},"@VERSION@",{requires:["flickr-promise","flickr-promise"],optional:["subscription-info-models","api-helper"]});YUI.add("hermes-template-user-account-card",function(t,n){var e=t.Template.Handlebars.revive({1:function(t,n,e,a,l){var s;return'\t\t\t<div class="pro-since-container">\n'+(null!=(s=t.invokePartial(a["pro-badge"],n,{name:"pro-badge",hash:{badgeType:null!=(s=null!=n?n.user:n)?s.proBadge:s},data:l,indent:"\t\t\t\t",helpers:e,partials:a,decorators:t.decorators}))?s:"")+"\t\t\t</div>\n"},3:function(t,n,e,a,l){var s,i=null!=n?n:{},r=e.helperMissing;return'\t\t\t<div class="graph-container">\n\t\t\t\t<div class="symbol icon infinity-icon"></div>\n\t\t\t</div>\n\t\t\t<div class="details-container">\n\t\t\t\t<p class="space-used-text">\n\t\t\t\t\t'+t.escapeExpression((e.intlMessage||n&&n.intlMessage||r).call(i,{name:"intlMessage",hash:{countString:(e.friendlyNumber||n&&n.friendlyNumber||r).call(i,null!=n?n.itemCount:n,{name:"friendlyNumber",hash:{},data:l}),itemCount:null!=n?n.itemCount:n,intlName:"common.ITEM_COUNT_FORMATTED"},data:l}))+"\n\t\t\t\t</p>\n\n"+(null!=(s=e.if.call(i,null!=n?n.isCancelledPro:n,{name:"if",hash:{},fn:t.program(4,l,0),inverse:t.program(6,l,0),data:l}))?s:"")+"\t\t\t</div>\n"},4:function(t,n,e,a,l){return'\t\t\t\t\t<a href="/account/upgrade/pro" class="re-subscribe-link">\n\t\t\t\t\t\t'+t.escapeExpression((e.intlMessage||n&&n.intlMessage||e.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"account-menu.RESUBSCRIBE_TO_PRO"},data:l}))+"\n\t\t\t\t\t</a>\n"},6:function(t,n,e,a,l){return'\t\t\t\t\t<a href="/upload" class="upload-link">\n\t\t\t\t\t\t'+t.escapeExpression((e.intlMessage||n&&n.intlMessage||e.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"account-menu.UPLOAD_YOUR_PHOTOS"},data:l}))+"\n\t\t\t\t\t</a>\n"},8:function(t,n,e,a,l){var s;return null!=(s=e.if.call(null!=n?n:{},null!=n?n.showOverLimitWarning:n,{name:"if",hash:{},fn:t.program(9,l,0),inverse:t.program(11,l,0),data:l}))?s:""},9:function(t,n,e,a,l){var s=null!=n?n:{},i=e.helperMissing,r=t.escapeExpression;return'\t\t\t\t<div class="graph-container">\n\t\t\t\t\t<div class="symbol warning-symbol"><span class="exclamation">!</span></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="details-container">\n\t\t\t\t\t<p class="space-used-text over-limit-warning">\n\t\t\t\t\t\t'+r((e.preventOrphans||n&&n.preventOrphans||i).call(s,(e.intlMessage||n&&n.intlMessage||i).call(s,{name:"intlMessage",hash:{limit:(e.friendlyNumber||n&&n.friendlyNumber||i).call(s,null!=n?n.itemLimit:n,{name:"friendlyNumber",hash:{},data:l}),count:(e.friendlyNumber||n&&n.friendlyNumber||i).call(s,null!=n?n.itemCount:n,{name:"friendlyNumber",hash:{},data:l}),intlName:"account-menu.ITEM_LIMIT_EXCEEDED"},data:l}),{name:"preventOrphans",hash:{},data:l}))+'\n\t\t\t\t\t</p>\n\n\t\t\t\t\t<span class="over-limit-warning-links">\n\t\t\t\t\t\t<a role="button" class="over-limit-learn-button">'+r((e.intlMessage||n&&n.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"common.LEARN_MORE"},data:l}))+'</a>\n\t\t\t\t\t\t<a href="/account/upgrade/pro">'+r((e.intlMessage||n&&n.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"common.GET_PRO"},data:l}))+"</a>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n"},11:function(t,n,e,a,l){var s,i=null!=n?n:{};return'\t\t\t\t<div class="graph-container">\n\t\t\t\t\t<div class="symbol graph"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="details-container">\n'+(null!=(s=e.if.call(i,null!=n?n.limitReached:n,{name:"if",hash:{},fn:t.program(12,l,0),inverse:t.program(14,l,0),data:l}))?s:"")+"\n"+(null!=(s=e.if.call(i,null!=n?n.isUnder500:n,{name:"if",hash:{},fn:t.program(16,l,0),inverse:t.program(18,l,0),data:l}))?s:"")+"\t\t\t\t</div>\n"},12:function(t,n,e,a,l){var s=null!=n?n:{},i=e.helperMissing;return'\t\t\t\t\t\t<p class="space-used-text limit-reached">\n\t\t\t\t\t\t\t'+t.escapeExpression((e.intlMessage||n&&n.intlMessage||i).call(s,{name:"intlMessage",hash:{limit:(e.friendlyNumber||n&&n.friendlyNumber||i).call(s,null!=n?n.itemLimit:n,{name:"friendlyNumber",hash:{},data:l}),intlName:"account-menu.ITEM_LIMIT_REACHED"},data:l}))+"\n\t\t\t\t\t\t</p>\n"},14:function(t,n,e,a,l){var s=null!=n?n:{},i=e.helperMissing;return'\t\t\t\t\t\t<p class="space-used-text">\n\t\t\t\t\t\t\t'+t.escapeExpression((e.intlMessage||n&&n.intlMessage||i).call(s,{name:"intlMessage",hash:{limit:(e.friendlyNumber||n&&n.friendlyNumber||i).call(s,null!=n?n.itemLimit:n,{name:"friendlyNumber",hash:{},data:l}),count:(e.friendlyNumber||n&&n.friendlyNumber||i).call(s,null!=n?n.itemCount:n,{name:"friendlyNumber",hash:{},data:l}),intlName:"account-menu.ITEM_COUNT_OF_LIMIT"},data:l}))+"\n\t\t\t\t\t\t</p>\n"},16:function(t,n,e,a,l){return'\t\t\t\t\t\t<a href="/photos/upload/">\n\t\t\t\t\t\t\t'+t.escapeExpression((e.intlMessage||n&&n.intlMessage||e.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"account-menu.UPLOAD_YOUR_PHOTOS"},data:l}))+" \n\t\t\t\t\t\t</a>\n"},18:function(t,n,e,a,l){return'\t\t\t\t\t\t<a href="/account/upgrade/pro" class="unlimited-storage-link">\n\t\t\t\t\t\t\t'+t.escapeExpression((e.intlMessage||n&&n.intlMessage||e.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"account-menu.GET_UNLIMITED_UPLOADS"},data:l}))+"\n\t\t\t\t\t\t</a>\n"},20:function(t,n,e,a,l){return" unread-messages "},compiler:[7,">= 4.0.0"],main:function(t,n,e,a,l){var s,i=null!=n?n:{},r=e.helperMissing,c=t.escapeExpression,u=t.lambda;return'<div class="account-card-container">\n\t<section class="greeting-section">\n\t\t<h4>'+c((e.renderTrustedMarkup||n&&n.renderTrustedMarkup||r).call(i,null!=(s=null!=n?n.greeting:n)?s.hello:s,{name:"renderTrustedMarkup",hash:{},data:l}))+"</h4>\n\n"+(null!=(s=e.if.call(i,null!=(s=null!=n?n.user:n)?s.isPro:s,{name:"if",hash:{},fn:t.program(1,l,0),inverse:t.noop,data:l}))?s:"")+"\n\t\t<p>"+c(u(null!=(s=null!=n?n.greeting:n)?s.caption:s,n))+'</p>\n\n\t</section>\n\t<section class="storage-section">\n'+(null!=(s=e.if.call(i,null!=(s=null!=n?n.user:n)?s.isPro:s,{name:"if",hash:{},fn:t.program(3,l,0),inverse:t.program(8,l,0),data:l}))?s:"")+'\t</section>\n\t<section class="menu-section">\n\t\t<ul>\n\t\t\t<li class="'+(null!=(s=e.if.call(i,null!=n?n.hasUnreadMessages:n,{name:"if",hash:{},fn:t.program(20,l,0),inverse:t.noop,data:l}))?s:"")+'" >\n\t\t\t\t<a href="/mail">\n\t\t\t\t\t'+c((e.intlMessage||n&&n.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.FLICKRMAIL"},data:l}))+"\n\t\t\t\t\t<span>"+c((e.intlMessage||n&&n.intlMessage||r).call(i,{name:"intlMessage",hash:{count:(e.formatNumber||n&&n.formatNumber||r).call(i,null!=n?n.unreadCount:n,{name:"formatNumber",hash:{},data:l}),intlName:"notifications.FLICKR_MAIL_COUNT_PAREN"},data:l}))+'</span>\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t\t<li>\n\t\t\t\t<a href="/account">'+c((e.intlMessage||n&&n.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.SETTINGS"},data:l}))+'</a>\n\t\t\t</li>\n\t\t\t<li>\n\t\t\t\t<a href="//help.flickr.com/">'+c((e.intlMessage||n&&n.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.HELP"},data:l}))+'</a>\n\t\t\t</li>\n\t\t\t<li>\n\t\t\t\t<a href="/logout.gne?csrf='+c(u(null!=(s=null!=n?n.user:n)?s.csrf:s,n))+'">'+c((e.intlMessage||n&&n.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.LOG_OUT"},data:l}))+"</a>\n\t\t\t</li>\n\t\t</ul>\n\t</section>\n</div>\n"},usePartial:!0,useData:!0}),a={};t.Array.each(["pro-badge"],function(n){var e=t.Template.get("hermes/"+n);e&&(a[n]=e)}),t.Template.register("hermes/user-account-card",function(n,l){return l=l||{},l.partials=l.partials?t.merge(a,l.partials):a,e(n,l)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-pro-badge"]});